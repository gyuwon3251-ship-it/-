let step = 0;
let dogName = "";
let scores = {E:0,I:0,S:0,N:0,T:0,F:0,J:0,P:0};
let anxietyScore = 0;

const questions = [
  {
    q:`Q1. 외출 준비(옷 입기, 열쇠 챙기기)를 할 때 아이의 반응은?`,
    a:[
      {t:`"다녀오세요~" 자기 자리에 가서 눕거나 별 반응 없다. (안정형)`, v:"I"},
      {t:`"나도 데려가!" 현관 앞을 막거나 안절부절못하며 낑낑거린다. (불안형)`, v:"E", anxiety:1},
      {t:`내가 나가자마자 하울링을 하거나 문을 긁는다. (고위험군)`, v:"E", anxiety:2}
    ]
  },
  {
    q:`Q2. 평소 '발사탕(발을 핥는 행동)'이나 꼬리 물기를 자주 하나요?`,
    a:[
      {t:`거의 하지 않는다.`, v:"S"},
      {t:`심심해 보일 때 가끔 핥거나 깨문다. (무료함/습관)`, v:"N", anxiety:1},
      {t:`발이 축축해질 정도로 자주 핥거나, 빙글빙글 도는 행동을 반복한다. (강박/스트레스)`, v:"N", anxiety:2}
    ]
  },
  {
    q:`Q3. '초인종 소리'나 '택배 기사님' 인기척에 대한 반응은?`,
    a:[
      {t:`귀만 쫑긋하고 짖지 않는다.`, v:"I"},
      {t:`"누구세요!" 한두 번 짖고 주인이 말리면 멈춘다.`, v:"E"},
      {t:`소리가 들리면 이성을 잃은 듯 짖고, 쉽게 진정되지 않는다. (경계성 예민)`, v:"E", anxiety:1}
    ]
  },
  {
    q:`Q4. 산책 중 낯선 강아지나 사람을 만났을 때?`,
    a:[
      {t:`꼬리를 흔들며 반갑게 인사하거나 무시하고 지나간다.`, v:"E"},
      {t:`내 뒤로 숨거나 걸음을 멈추고 얼어버린다. (공포/회피)`, v:"I", anxiety:1},
      {t:`털을 세우고 으르렁거리거나 달려들려고 한다. (방어적 공격성)`, v:"T", anxiety:1}
    ]
  },
  {
    q:`Q5. 아이의 평소 수면 스타일은 어떤가요?`,
    a:[
      {t:`배를 까뒤집고 세상 모르고 '떡실신' 한다.`, v:"P"},
      {t:`작은 소리에도 벌떡 일어나거나, 자리를 자주 옮긴다.`, v:"J", anxiety:1},
      {t:`잘 때도 몸을 웅크리고, 눈을 뜨고 자거나 꿈틀거림이 심하다. (긴장 상태)`, v:"J", anxiety:2}
    ]
  },
  {
    q:`Q6. 혼자 있을 때 집안 물건(벽지, 휴지, 가구)을 훼손한 적이 있나요?`,
    a:[
      {t:`전혀 없다. 장난감만 가지고 논다.`, v:"I"},
      {t:`어릴 때는 그랬지만 지금은 가끔 실수만 한다.`, v:"P"},
      {t:`혼자 두면 휴지통을 뒤지거나 물건을 물어뜯어 놓는다. (불만 표출/파괴)`, v:"E", anxiety:1}
    ]
  },
  {
    q:`Q7. 평소 스킨십(빗질, 목욕, 발톱 깎기)을 할 때 반응은?`,
    a:[
      {t:`얌전히 잘 받거나 즐기는 편이다.`, v:"F"},
      {t:`싫어하지만 간식을 주면 참아낸다.`, v:"T"},
      {t:`손만 대려 해도 기겁하거나 입질을 하려 한다. (접촉 스트레스/트라우마)`, v:"T", anxiety:2}
    ]
  },
  {
    q:`Q8. 최근 들어 이유 없이 구토를 하거나 설사(무른 변)를 한 적이 있나요?`,
    a:[
      {t:`황금 변을 보고 소화력도 좋다.`, v:"S"},
      {t:`낯선 곳에 가거나 혼나면 가끔 그런다.`, v:"N", anxiety:1},
      {t:`병원에서는 이상 없다는데 자주 토하거나 변이 묽다. (신경성 위장 장애)`, v:"N", anxiety:2}
    ]
  },
  {
    q:`Q9. 우리 아이가 가장 행복해 보일 때는 언제인가요?`,
    a:[
      {t:`넓은 공원을 마음껏 뛰어놀 때 (에너지 발산 욕구)`, v:"E"},
      {t:`내 무릎 위에서 편안하게 쓰다듬어질 때 (애정/안정 욕구)`, v:"F"},
      {t:`맛있는 간식을 먹을 때 (식탐/보상 욕구)`, v:"S"}
    ]
  },
  {
    q:`Q10. 견주님이 아이에게 바라는 단 한 가지 소원은?`,
    a:[
      {t:`아프지 않고 튼튼하게 오래 사는 것 (신체 건강)`, v:"S"},
      {t:`불안해하지 않고 마음 편하게 지내는 것 (정신 건강/안정)`, v:"F"},
      {t:`나 없이도 씩씩하게 잘 지내는 것 (독립심)`, v:"I"}
    ]
  }
];

const resultData = {
INTJ:{title:`INTJ (용의주도한 전략가) "고독한 천재형"`,text:`"난 혼자 있는 게 좋아. 귀찮게 하지 마."

- 성향: 독립심이 강하고 낯선 사람에게 곁을 잘 안 줍니다. 자기만의 규칙이 확실합니다.
- 숨겨진 스트레스: 자신의 루틴이나 영역이 침범당할 때 극도로 예민해집니다.
- 폴라밸런스 처방: "혼자만의 시간에도 편안함을 느끼도록. 까칠한 신경을 부드럽게 감싸줄 [이너 릴렉싱 케어]가 필요합니다."`},

INTP:{title:`INTP (논리적인 사색가) "귀차니즘 만렙형"`,text:`"산책? 꼭 가야 해? 집에서 냄새나 맡을래."

- 성향: 호기심은 있지만 몸 쓰는 건 싫어합니다. 자기만의 세계가 확고한 타입입니다.
- 숨겨진 스트레스: 지루함을 못 견뎌 발사탕을 핥거나 같은 행동을 반복하는 '강박 증세'가 생길 수 있습니다.
- 폴라밸런스 처방: "무료함은 마음의 병이 됩니다. 반복 행동을 멈추고 심신을 안정시켜 줄 [마인드 밸런스]를 선물하세요."`},

ENTJ:{title:`ENTJ (통솔자) "카리스마 골목대장형"`,text:`"내 구역에서 내 허락 없이 지나가는 놈 누구야!"

- 성향: 산책 시 다른 개들을 제압하려 하거나 리드하려 합니다. 고집이 센 편입니다.
- 숨겨진 스트레스: 자신이 상황을 통제하지 못할 때 오는 분노와 흥분 상태가 지속됩니다.
- 폴라밸런스 처방: "리더에게도 휴식이 필요합니다. 24시간 곤두선 지휘 본능을 잠재워 줄 [카밍 휴식 솔루션]이 시급합니다."`},

ENTP:{title:`ENTP (변론가) "장꾸력 폭발 개그캐형"`,text:`"이거 물어뜯으면 엄마가 소리 지르겠지? 재밌겠다!"

- 성향: 두뇌 회전이 빨라 사고 치는 스케일이 다릅니다. 혼나도 기죽지 않는 명랑함이 있습니다.
- 숨겨진 스트레스: 넘치는 에너지를 주체 못 해 스스로 '과흥분(Hyper)' 상태가 지속되어 숙면을 못 취합니다.
- 폴라밸런스 처방: "장난기는 지키되, 산만함은 잡아주세요. 들뜬 마음을 차분하게 가라앉혀 줄 [집중 케어 솔루션]."`},

INFJ:{title:`INFJ (옹호자) "눈치 백단 예언가형"`,text:`"엄마 기분이 안 좋아 보여... 나도 슬퍼져..."

- 성향: 주인의 감정을 스펀지처럼 흡수합니다. 조용하고 사려 깊은 성격입니다.
- 숨겨진 스트레스: 주인의 작은 한숨, 집안의 무거운 분위기에 가장 큰 스트레스를 받습니다.
- 폴라밸런스 처방: "착한 아이일수록 속병이 듭니다. 아이가 짊어진 감정의 무게를 덜어줄 [심신 안정 테라피]가 필수입니다."`},

INFP:{title:`INFP (중재자) "방구석 시인형"`,text:`"큰 소리 싫어요.. 낯선 사람 무서워요.."

- 성향: 겁이 많고 소심합니다. 익숙한 곳, 익숙한 사람만 좋아합니다.
- 숨겨진 스트레스: 낯선 환경, 소음, 변화 그 자체에 대해 늘 긴장 상태를 유지합니다.
- 폴라밸런스 처방: "세상은 무서운 곳이 아니란다. 콩닥거리는 가슴을 진정시켜 줄 [용기 한 스푼, 폴라밸런스]."`},

ENFJ:{title:`ENFJ (선도자) "사랑둥이 댕댕이형"`,text:`"나만 바라봐! 나 예뻐해 줘! 계속 만져줘!"

- 성향: 사람을 너무 좋아하고 눈 맞춤을 잘합니다. 애교 덩어리 그 자체입니다.
- 숨겨진 스트레스: 관심이 조금만 줄어들어도 느끼는 극심한 애정결핍과 소외감.
- 폴라밸런스 처방: "사랑받고 싶어 하는 마음이 불안으로 변하지 않게. 마음의 허기를 채워줄 [정서 안정 케어]."`},

ENFP:{title:`ENFP (활동가) "해피 바이러스형"`,text:`"어? 저 사람 나 좋아하나 봐! (꼬리 프로펠러 가동)"

- 성향: 세상 모든 게 신나고 궁금합니다. 산책 나가면 친구 만들기 바쁩니다.
- 숨겨진 스트레스: 혼자 남겨지는 순간 찾아오는 급격한 우울감(분리불안 최고봉).
- 폴라밸런스 처방: "혼자서도 씩씩하게 기다릴 수 있도록. 외로움을 달래주는 따뜻한 위로, [분리불안 케어 솔루션]."`},

ISTJ:{title:`ISTJ (현실주의자) "엄격한 선비형"`,text:`"밥 시간 5분 지났습니다. 산책 코스가 틀렸습니다."

- 성향: 생활 루틴이 정확합니다. 변화를 싫어하고 늘 하던 대로 해야 직성이 풀립니다.
- 숨겨진 스트레스: 이사, 가구 배치 변경, 손님 방문 등 루틴이 깨질 때 불안을 느낍니다.
- 폴라밸런스 처방: "작은 변화에도 스트레스받는 예민함. 아이의 평정심을 지켜줄 [데일리 릴렉스]가 필요합니다."`},

ISFJ:{title:`ISFJ (수호자) "현모양처 천사형"`,text:`"난 괜찮아, 가족들만 편안하다면."

- 성향: 짖지도 않고 말썽도 안 피우는 순둥이입니다. 참을성이 많습니다.
- 숨겨진 스트레스: 싫어도 참고, 아파도 참습니다. 겉으론 멀쩡해도 억눌린 스트레스가 큽니다.
- 폴라밸런스 처방: "참는 게 착한 건 아닙니다. 속으로 삭히고 있을 아이의 마음을 어루만져 줄 [속마음 케어]."`},

ESTJ:{title:`ESTJ (경영자) "우리 집 보안관형"`,text:`"수상한 소리 포착! 즉시 짖어서 알린다! 멍! 멍!"

- 성향: 책임감이 강해 집을 지키려 합니다. 외부 소리에 민감하게 반응합니다.
- 숨겨진 스트레스: 24시간 경계 태세를 유지하느라 뇌가 쉴 틈이 없습니다 (수면 부족).
- 폴라밸런스 처방: "보안관 배지는 내려놓고 꿀잠 자렴. 곤두선 신경을 이완시켜 줄 [숙면 유도 테라피]."`},

ESFJ:{title:`ESFJ (집정관) "핵인싸 반장님형"`,text:`"내 친구 건드리지 마! 우리 가족은 내가 챙겨!"

- 성향: 오지랖이 넓고 질투심도 있습니다. 가족들 사이에 끼어드는 걸 좋아합니다.
- 숨겨진 스트레스: 다른 강아지를 예뻐하거나 자신이 소외될 때 느끼는 질투와 불안.
- 폴라밸런스 처방: "질투는 불안의 다른 이름입니다. 마음의 여유를 찾아줄 [해피 스마일 솔루션]."`},

ISTP:{title:`ISTP (장인) "시크한 냥멍이형"`,text:`"만지지 마. 기분 내킬 때 내가 갈게."

- 성향: 고양이 같은 성격입니다. 필요할 때만 다가오고 간섭을 싫어합니다.
- 숨겨진 스트레스: 과도한 스킨십이나 억지로 하는 훈련에 대해 강한 거부감을 느낍니다.
- 폴라밸런스 처방: "예민한 감각의 소유자입니다. 귀찮은 게 아니라 피곤한 겁니다. 예민도를 낮춰줄 [스트레스 제로 케어]."`},

ISFP:{title:`ISFP (모험가) "침대 밖은 위험해형"`,text:`"이불 밖은 무서워... 그냥 누워서 간식이나 먹을래."

- 성향: 온순하고 평화롭습니다. 게으르고 누워있는 걸 제일 좋아합니다.
- 숨겨진 스트레스: 억지로 시키는 산책이나 활동, 큰 소리에 대한 공포가 있습니다.
- 폴라밸런스 처방: "유리처럼 깨지기 쉬운 섬세한 감성. 놀란 가슴을 진정시켜 줄 [마음 진정 앰플]."`},

ESTP:{title:`ESTP (사업가) "직진 본능 불도저형"`,text:`"저건 뭐지? 일단 돌진해! 부딪혀도 안 아파!"

- 성향: 겁이 없고 행동이 앞섭니다. 사고뭉치지만 미워할 수 없는 매력이 있습니다.
- 숨겨진 스트레스: 넘치는 에너지를 발산하지 못할 때 오는 답답함과 파괴 본능.
- 폴라밸런스 처방: "진정해, 워워. 브레이크 고장 난 에너지를 차분하게 조절해 줄 [캄 다운(Calm Down) 솔루션]."`},

ESFP:{title:`ESFP (연예인) "관종끼 다분한 아이돌형"`,text:`"나 오늘 예뻐? 춤출까? 간식 줄 거야?"

- 성향: 주목받는 걸 즐기고 텐션이 높습니다. 기분파입니다.
- 숨겨진 스트레스: 분위기가 다운되거나 무시당하는 것을 못 견딥니다. 감정 기복이 심합니다.
- 폴라밸런스 처방: "롤러코스터 같은 감정 기복. 들쑥날쑥한 기분을 편안하게 잡아줄 [멘탈 밸런싱 케어]."`}
};

function startTest(){
  dogName = document.getElementById("dogName").value;
  if(!dogName){ alert("강아지 이름을 입력해주세요"); return; }
  document.getElementById("start").classList.remove("active");
  document.getElementById("quiz").classList.add("active");
  render();
}

function render(){
  const q = questions[step];
  let html = `<h2>${q.q}</h2>`;
  q.a.forEach(o=>{
    html += `<div class="option" onclick="answer('${o.v}',${o.anxiety||0})">${o.t}</div>`;
  });
  document.getElementById("quiz").innerHTML = html;
}

function answer(v,a){
  scores[v]++; anxietyScore += a;
  step++; step<questions.length ? render() : showResult();
}

function showResult(){
  const mbti =
    (scores.E>=scores.I?"E":"I")+
    (scores.S>=scores.N?"S":"N")+
    (scores.T>=scores.F?"T":"F")+
    (scores.J>=scores.P?"J":"P");

  const d = resultData[mbti];
  const 강조 = anxietyScore>=4 ? "style='background:#e60023;font-size:18px'" : "";

  document.getElementById("quiz").classList.remove("active");
  document.getElementById("result").classList.add("active");

  document.getElementById("result").innerHTML = `
  <h2>${dogName}의 멍BTI 결과</h2>
  <img src="images/${mbti}.jpg" class="result-img">
  <h3>${d.title}</h3>
  <pre>${d.text}</pre>

  <p>
"MBTI는 재미로 보지만, 아이의 스트레스는 다큐입니다."

검사 결과, 우리 아이는 겉모습과 달리
속으로는 알게 모르게 긴장하고 스트레스를 받고 있습니다.

돈으로 아이의 마음을 살 순 없지만,
마음의 평화는 선물할 수 있습니다.

수의사가 설계한 [폴라밸런스]로
오늘 밤부터 우리 아이에게 진정한 '꿀잠'과 '안정'을 선물하세요.
  </p>

  <button ${강조} onclick="location.href='https://www.coupang.com/vp/products/9083913135'">
  👉 우리 아이 맞춤 [마음 처방전] 확인하기
  </button>

  <button onclick="shareKakao('${mbti}')">카카오톡 공유</button>
  `;
}
